<p>In this post, I’ll walk you through my implementation of two desktop
mascot applications for macOS: xNeko (a recreation of the classic
cursor-chasing cat) and xMascot (a physics-based swinging mascot). This
project taught me that desktop mascots are fundamentally about creating
the illusion of life through simple state machines and coordinate
transformations. The technical challenge lies in managing window
properties to create transparent, always-on-top overlays while
implementing smooth animations that respond to user interaction. I
learned that macOS window management requires careful configuration to
achieve the effect of a sprite living on the desktop rather than in a
traditional window. Working with Swift and SwiftUI for xNeko versus
SpriteKit for xMascot revealed the trade-offs between declarative UI
frameworks and specialized game engines. Most importantly, I discovered
that making something feel alive requires surprisingly little code when
you get the animation timing and state transitions right.</p>
<p>Desktop mascots have a long history in computing, with the original
Neko (Japanese for “cat”) created by Kenji Gotoh in 1989 for the NEC
PC-9801. The concept is simple but charming: a small animated character
lives on your desktop, following the mouse cursor around the screen.
When the cursor stops, the cat stops and eventually falls asleep. The
appeal lies in the personality conveyed through just a few animation
states and simple movement logic.</p>
<p>The challenge was to recreate this experience on modern macOS while
adding my own variations: faithful recreation of the classic Neko
behavior with multiple character sprites, transparent borderless windows
that ignore mouse events, smooth sprite animation with proper frame
timing, and a second application exploring physics-based animation with
pendulum motion. Each aspect required understanding both macOS windowing
APIs and animation techniques.</p>
<h1 id="window-configuration-for-desktop-overlays">Window Configuration
for Desktop Overlays</h1>
<p>Both applications require creating windows that appear to float on
the desktop rather than behaving like traditional application windows.
This involves careful manipulation of window properties through AppKit.
The key is making windows that are transparent, frameless, always on
top, and non-interactive with the mouse (except when we want
interaction).</p>
<p>For xNeko, I configure the window in the <code>AppDelegate</code>
immediately after launch:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">hideTitleBar</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">guard</span> <span class="kw">let</span> <span class="va">window</span> <span class="op">=</span> NSApplication<span class="op">.</span>shared<span class="op">.</span>windows<span class="op">.</span>first <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        assertionFailure<span class="op">()</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    NSApplication<span class="op">.</span>shared<span class="op">.</span>activate<span class="op">(</span>ignoringOtherApps<span class="op">:</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>setFrame<span class="op">(</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        NSRect<span class="op">(</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            x<span class="op">:</span> window<span class="op">.</span>screen<span class="op">!.</span>frame<span class="op">.</span>width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            y<span class="op">:</span> window<span class="op">.</span>screen<span class="op">!.</span>frame<span class="op">.</span>height <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            width<span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            height<span class="op">:</span> <span class="dv">40</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">),</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        display<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>backingType <span class="op">=</span> <span class="op">.</span>buffered</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>canHide <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>level <span class="op">=</span> <span class="op">.</span>floating</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>isMovableByWindowBackground <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>ignoresMouseEvents <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>isOpaque <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>titlebarAppearsTransparent <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>backgroundColor <span class="op">=</span> <span class="op">.</span>clear</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>hasShadow <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    window<span class="op">.</span>styleMask<span class="op">.</span>remove<span class="op">(.</span>resizable<span class="op">)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">closeButton</span> <span class="op">=</span> window<span class="op">.</span>standardWindowButton<span class="op">(.</span>closeButton<span class="op">)!</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    closeButton<span class="op">.</span>isEnabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    closeButton<span class="op">.</span>isHidden <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">miniButton</span> <span class="op">=</span> window<span class="op">.</span>standardWindowButton<span class="op">(.</span>miniaturizeButton<span class="op">)!</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    miniButton<span class="op">.</span>isHidden <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    miniButton<span class="op">.</span>isEnabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">zoomButton</span> <span class="op">=</span> window<span class="op">.</span>standardWindowButton<span class="op">(.</span>zoomButton<span class="op">)!</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    zoomButton<span class="op">.</span>isHidden <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    zoomButton<span class="op">.</span>isEnabled <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The window level <code>.floating</code> ensures it stays above normal
windows but below system alerts. Setting
<code>ignoresMouseEvents = true</code> allows clicking through the
window to interact with applications underneath. The transparent title
bar and clear background create the illusion that the sprite is directly
on the desktop. Disabling the standard window buttons (close, minimize,
zoom) removes all traditional window chrome.</p>
<p>For xMascot, the configuration is similar but the window is larger
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>265</mn><mo>×</mo><mn>320</mn></mrow><annotation encoding="application/x-tex">265 \times 320</annotation></semantics></math>
pixels) and positioned in the upper-right corner to accommodate the
swinging chain visualization:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>window<span class="op">.</span>setFrame<span class="op">(</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    NSRect<span class="op">(</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        x<span class="op">:</span> window<span class="op">.</span>screen<span class="op">!.</span>frame<span class="op">.</span>width <span class="op">-</span> <span class="dv">205</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        y<span class="op">:</span> window<span class="op">.</span>screen<span class="op">!.</span>frame<span class="op">.</span>height<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        width<span class="op">:</span> <span class="dv">265</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        height<span class="op">:</span> <span class="dv">320</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">),</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    display<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
<p>The critical insight is that these aren’t traditional application
windows. They’re overlays that happen to use the window system’s
rendering pipeline while opting out of most window management
features.</p>
<h1 id="xneko-state-machine-and-cursor-tracking">xNeko: State Machine
and Cursor Tracking</h1>
<p>The Neko mascot implements a finite state machine with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>18</mn><annotation encoding="application/x-tex">18</annotation></semantics></math>
distinct states corresponding to different animations: <code>stop</code>
(idle), <code>jare</code> (scratching behind ear), <code>kaki</code>
(scratching body), <code>akubi</code> (yawning), <code>sleep</code>
(sleeping), <code>awake</code> (waking up), eight directional movement
states (<code>umove</code>, <code>dmove</code>, <code>lmove</code>,
<code>rmove</code>, <code>ulmove</code>, <code>urmove</code>,
<code>dlmove</code>, <code>drmove</code>), and four directional stop
states (<code>utogi</code>, <code>dtogi</code>, <code>ltogi</code>,
<code>rtogi</code>).</p>
<p>Each state has associated sprite frames stored in animation
dictionaries:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nekoAnimations <span class="op">=</span> <span class="op">[</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;stop&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;mati2&quot;</span><span class="op">],</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;jare&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;jare2&quot;</span><span class="op">,</span> <span class="st">&quot;mati2&quot;</span><span class="op">],</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;kaki&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;kaki1&quot;</span><span class="op">,</span> <span class="st">&quot;kaki2&quot;</span><span class="op">],</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;akubi&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;mati3&quot;</span><span class="op">],</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sleep&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;sleep1&quot;</span><span class="op">,</span> <span class="st">&quot;sleep2&quot;</span><span class="op">],</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;awake&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;awake&quot;</span><span class="op">],</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;umove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;up1&quot;</span><span class="op">,</span> <span class="st">&quot;up2&quot;</span><span class="op">],</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;down1&quot;</span><span class="op">,</span> <span class="st">&quot;down2&quot;</span><span class="op">],</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;left1&quot;</span><span class="op">,</span> <span class="st">&quot;left2&quot;</span><span class="op">],</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;rmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;right1&quot;</span><span class="op">,</span> <span class="st">&quot;right2&quot;</span><span class="op">],</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ulmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;upleft1&quot;</span><span class="op">,</span> <span class="st">&quot;upleft2&quot;</span><span class="op">],</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;urmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;upright1&quot;</span><span class="op">,</span> <span class="st">&quot;upright2&quot;</span><span class="op">],</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dlmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;dwleft1&quot;</span><span class="op">,</span> <span class="st">&quot;dwleft2&quot;</span><span class="op">],</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;drmove&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;dwright1&quot;</span><span class="op">,</span> <span class="st">&quot;dwright2&quot;</span><span class="op">],</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;utogi&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;utogi1&quot;</span><span class="op">,</span> <span class="st">&quot;utogi2&quot;</span><span class="op">],</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dtogi&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;dtogi1&quot;</span><span class="op">,</span> <span class="st">&quot;dtogi2&quot;</span><span class="op">],</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ltogi&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;ltogi1&quot;</span><span class="op">,</span> <span class="st">&quot;ltogi2&quot;</span><span class="op">],</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;rtogi&quot;</span><span class="op">:</span> <span class="op">[</span><span class="st">&quot;rtogi1&quot;</span><span class="op">,</span> <span class="st">&quot;rtogi2&quot;</span><span class="op">],</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="op">].</span>mapValues <span class="op">{</span> createImageArray<span class="op">(</span>imageNames<span class="op">:</span> $<span class="dv">0</span><span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>The core game loop runs on a timer at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.15</mn><annotation encoding="application/x-tex">0.15</annotation></semantics></math>
second intervals (approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>6.67</mn><annotation encoding="application/x-tex">6.67</annotation></semantics></math>
FPS for state updates, though sprite animation alternates giving
perceived
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>13.34</mn><annotation encoding="application/x-tex">13.34</annotation></semantics></math>
FPS):</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Timer<span class="op">.</span>scheduledTimer<span class="op">(</span>withTimeInterval<span class="op">:</span> <span class="fl">0.15</span><span class="op">,</span> repeats<span class="op">:</span> <span class="kw">true</span><span class="op">)</span> <span class="op">{</span> _ <span class="cf">in</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    timerAction<span class="op">()</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Each timer tick updates the animation frame, checks the cursor
position, and potentially transitions states. The cursor tracking
calculates a displacement vector from the window to the mouse:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">calculateDisplacement</span><span class="op">(</span><span class="va">frameOrigin</span><span class="op">:</span> <span class="dt">CGVector</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">mouse</span> <span class="op">=</span> NSEvent<span class="op">.</span>mouseLocation</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">delta</span> <span class="op">=</span> CGVector<span class="op">(</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        dx<span class="op">:</span> floor<span class="op">(</span>Double<span class="op">(</span>mouse<span class="op">.</span>x <span class="op">-</span> frameOrigin<span class="op">.</span>dx<span class="op">)</span> <span class="op">-</span> <span class="fl">20.0</span><span class="op">),</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        dy<span class="op">:</span> floor<span class="op">(</span>Double<span class="op">(</span>mouse<span class="op">.</span>y <span class="op">-</span> frameOrigin<span class="op">.</span>dy<span class="op">)</span> <span class="op">-</span> <span class="fl">45.0</span><span class="op">)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">length</span> <span class="op">=</span> hypotf<span class="op">(</span>Float<span class="op">(</span>delta<span class="op">.</span>dx<span class="op">),</span> Float<span class="op">(</span>delta<span class="op">.</span>dy<span class="op">))</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> length <span class="op">!=</span> <span class="fl">0.0</span> <span class="op">{</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> length <span class="op">&lt;=</span> <span class="fl">13.0</span> <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            displacement <span class="op">=</span> delta</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            displacement <span class="op">=</span> <span class="op">(</span><span class="fl">13.0</span> <span class="op">*</span> delta<span class="op">)</span> <span class="op">/</span> CGFloat<span class="op">(</span>length<span class="op">)</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        displacement <span class="op">=</span> CGVector<span class="op">()</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The displacement is clamped to a maximum magnitude of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>13</mn><annotation encoding="application/x-tex">13</annotation></semantics></math>
pixels per frame, preventing the cat from teleporting large distances.
When the cursor is within
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>13</mn><annotation encoding="application/x-tex">13</annotation></semantics></math>
pixels, the cat moves exactly to the cursor position. Otherwise, it
moves
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>13</mn><annotation encoding="application/x-tex">13</annotation></semantics></math>
pixels toward the cursor.</p>
<p>Direction calculation uses the displacement vector to determine which
of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>8</mn><annotation encoding="application/x-tex">8</annotation></semantics></math>
directional movement states to enter. This is done by calculating the
angle and using threshold values:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">calculateDirection</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> displacement <span class="op">==</span> CGVector<span class="op">.</span>zero <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;stop&quot;</span><span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="va">length</span> <span class="op">=</span> hypotf<span class="op">(</span>Float<span class="op">(</span>displacement<span class="op">.</span>dx<span class="op">),</span> Float<span class="op">(</span>displacement<span class="op">.</span>dy<span class="op">))</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="va">sinTheta</span> <span class="op">=</span> Float<span class="op">(</span>displacement<span class="op">.</span>dy<span class="op">)</span> <span class="op">/</span> length</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> displacement<span class="op">.</span>dx <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="fl">0.9239</span> <span class="op">{</span>  <span class="co">// ~67.5 degrees</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;umove&quot;</span><span class="op">)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="fl">0.3827</span> <span class="op">{</span>  <span class="co">// ~22.5 degrees</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;urmove&quot;</span><span class="op">)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.3827</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;rmove&quot;</span><span class="op">)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.9239</span> <span class="op">{</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;drmove&quot;</span><span class="op">)</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;dmove&quot;</span><span class="op">)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Mirror logic for leftward movement</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="fl">0.9239</span> <span class="op">{</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;umove&quot;</span><span class="op">)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="fl">0.3827</span> <span class="op">{</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;ulmove&quot;</span><span class="op">)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.3827</span> <span class="op">{</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;lmove&quot;</span><span class="op">)</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> sinTheta <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.9239</span> <span class="op">{</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;dlmove&quot;</span><span class="op">)</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                setStateTo<span class="op">(</span><span class="st">&quot;dmove&quot;</span><span class="op">)</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The threshold values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.9239</mn><annotation encoding="application/x-tex">0.9239</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.3827</mn><annotation encoding="application/x-tex">0.3827</annotation></semantics></math>)
correspond to sine values at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>22.5</mn><annotation encoding="application/x-tex">22.5</annotation></semantics></math>-degree
increments, dividing the circle into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>8</mn><annotation encoding="application/x-tex">8</annotation></semantics></math>
equal sectors. This ensures smooth directional transitions as the cat
follows the cursor.</p>
<p>The idle behavior implements a sequence of states that trigger when
the cursor stops moving:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;stop&quot;</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shouldBeMoving <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;awake&quot;</span><span class="op">)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> stateCount <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;jare&quot;</span><span class="op">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;jare&quot;</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shouldBeMoving <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;awake&quot;</span><span class="op">)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> stateCount <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;kaki&quot;</span><span class="op">)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;kaki&quot;</span> <span class="op">{</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shouldBeMoving <span class="op">{</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;awake&quot;</span><span class="op">)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> stateCount <span class="op">&lt;</span> <span class="dv">4</span> <span class="op">{</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;akubi&quot;</span><span class="op">)</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;akubi&quot;</span> <span class="op">{</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shouldBeMoving <span class="op">{</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;awake&quot;</span><span class="op">)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> stateCount <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Wait</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;sleep&quot;</span><span class="op">)</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;sleep&quot;</span> <span class="op">{</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> shouldBeMoving <span class="op">{</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        setStateTo<span class="op">(</span><span class="st">&quot;awake&quot;</span><span class="op">)</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The cat progresses through idle animations (stop, scratch ear,
scratch body, yawn, sleep) with delays between each state. Any cursor
movement interrupts the sequence by transitioning to “awake”, which then
checks the cursor position and enters a movement state if needed.</p>
<h1 id="multiple-character-support">Multiple Character Support</h1>
<p>xNeko includes six different characters, each with complete sprite
sets: Neko (the original cat), Sakura (from Cardcaptor Sakura), Dog (a
puppy variant), Tomoyo (also from Cardcaptor Sakura), BSD Demon (the BSD
mascot), and Tora (a tiger variant). Each character has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>32</mn><annotation encoding="application/x-tex">32</annotation></semantics></math>-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>40</mn><annotation encoding="application/x-tex">40</annotation></semantics></math>
individual sprite frames covering all animation states.</p>
<p>The character selection is implemented through SwiftUI’s Settings
panel:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Settings <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    SettingsView<span class="op">().</span>environmentObject<span class="op">(</span>settingsData<span class="op">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> SettingsView<span class="op">:</span> <span class="dt">View</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@State</span> <span class="kw">var</span> <span class="va">options</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;Neko&quot;</span><span class="op">,</span> <span class="st">&quot;Sakura&quot;</span><span class="op">,</span> <span class="st">&quot;Dog&quot;</span><span class="op">,</span> <span class="st">&quot;Tomoyo&quot;</span><span class="op">,</span> <span class="st">&quot;BSD Demon&quot;</span><span class="op">,</span> <span class="st">&quot;Tora&quot;</span><span class="op">]</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@EnvironmentObject</span> <span class="kw">var</span> <span class="va">settingsData</span><span class="op">:</span> SettingsData</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">body</span><span class="op">:</span> some View <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        Picker<span class="op">(</span><span class="st">&quot;Select a character&quot;</span><span class="op">,</span> selection<span class="op">:</span> $settingsData<span class="op">.</span>selectedItem<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            ForEach<span class="op">(</span>options<span class="op">,</span> id<span class="op">:</span> \<span class="op">.</span><span class="kw">self</span><span class="op">)</span> <span class="op">{</span> item <span class="cf">in</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                Text<span class="op">(</span>item<span class="op">)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>padding<span class="op">(</span><span class="dv">20</span><span class="op">)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>frame<span class="op">(</span>width<span class="op">:</span> <span class="dv">275</span><span class="op">,</span> height<span class="op">:</span> <span class="dv">75</span><span class="op">)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The selected character is stored in an <code>@Published</code>
property of <code>SettingsData</code>, which is observed by the main
view. When the selection changes, the animation dictionary is
swapped:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="va">selectedCharacter</span> <span class="op">=</span> settingsData<span class="op">.</span>selectedItem</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> selectedCharacter <span class="op">!=</span> currentCharacter <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    currentCharacter <span class="op">=</span> selectedCharacter</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;Neko&quot;</span> <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> nekoAnimations</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;Sakura&quot;</span> <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> sakuraAnimations</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;Dog&quot;</span> <span class="op">{</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> dogAnimations</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;Tomoyo&quot;</span> <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> tomoyoAnimations</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;BSD Demon&quot;</span> <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> bsdAnimations</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> selectedCharacter <span class="op">==</span> <span class="st">&quot;Tora&quot;</span> <span class="op">{</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        animations <span class="op">=</span> toraAnimations</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This approach keeps the state machine logic identical across
characters while allowing complete visual customization. Each sprite set
maintains the same naming convention (e.g., <code>mati2_sakura</code>,
<code>up1_dog</code>) so the animation dictionary lookups work
uniformly.</p>
<h1 id="xmascot-physics-based-pendulum-simulation">xMascot:
Physics-Based Pendulum Simulation</h1>
<p>While xNeko uses discrete states and position tracking, xMascot
implements continuous physics simulation using SpriteKit. The mascot
hangs from a chain and swings back and forth like a pendulum when
disturbed. This creates a more dynamic, physics-driven animation.</p>
<p>The physics simulation uses the standard pendulum equation. For a
pendulum at angle
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
from vertical, the angular acceleration is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mi>−</mi><mfrac><mi>g</mi><mi>L</mi></mfrac><mrow><mi mathvariant="normal">sin</mi><mo>&#8289;</mo></mrow><mo stretchy="false" form="prefix">(</mo><mi>θ</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\alpha = -\frac{g}{L} \sin(\theta)</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
is gravitational acceleration and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>
is the pendulum length. In my implementation, I use normalized units
where gravity constant is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.02</mn><annotation encoding="application/x-tex">0.02</annotation></semantics></math>
and the radius (length) varies per chain link:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Mascot <span class="op">:</span> <span class="dt">SKSpriteNode</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">acceleration</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">angle</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">velocity</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">radius</span> <span class="op">=</span> <span class="fl">160.0</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">damping</span> <span class="op">=</span> <span class="fl">0.97</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">func</span> <span class="fu">update</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="va">gravity</span> <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        acceleration <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> gravity <span class="op">*</span> sin<span class="op">(</span>angle<span class="op">)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        velocity <span class="op">+=</span> acceleration</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        angle <span class="op">+=</span> velocity</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        velocity <span class="op">*=</span> damping</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        zRotation <span class="op">=</span> angle</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        position <span class="op">=</span> CGPoint<span class="op">(</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            x<span class="op">:</span> radius <span class="op">*</span> sin<span class="op">(</span>angle<span class="op">),</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>            y<span class="op">:</span> <span class="op">-</span>radius <span class="op">*</span> cos<span class="op">(</span>angle<span class="op">)</span> <span class="op">+</span> <span class="dv">120</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The damping factor
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.97</mn><annotation encoding="application/x-tex">0.97</annotation></semantics></math>)
represents energy loss from air resistance and friction, causing the
pendulum to gradually slow down. Without damping, it would swing
forever. The position is calculated using polar-to-Cartesian conversion,
with the origin offset by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>120</mn><annotation encoding="application/x-tex">120</annotation></semantics></math>
pixels to position the pivot point correctly in the window.</p>
<p>The chain consists of seven individual links, each simulated as a
separate pendulum with different radii:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="cf">in</span> <span class="fl">1.</span><span class="op">.</span><span class="fl">.7</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">singleChainLink</span> <span class="op">=</span> SingleChainLink<span class="op">(</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        givenRadius<span class="op">:</span> Double<span class="op">(</span>i <span class="op">*</span> <span class="dv">20</span><span class="op">),</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        givenSmoothingFactor<span class="op">:</span> pow<span class="op">(</span>Double<span class="op">(</span>i<span class="op">)</span> <span class="op">/</span> <span class="dv">7</span><span class="op">,</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    addChild<span class="op">(</span>singleChainLink<span class="op">)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Each link is positioned at radius
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mi>i</mi></mrow><annotation encoding="application/x-tex">20i</annotation></semantics></math>
pixels from the pivot. The smoothing factor creates a cascading effect
where links further from the pivot have slightly different damping,
making the chain appear more flexible and realistic. The chain links use
a modified update that includes the smoothing:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SingleChainLink <span class="op">:</span> <span class="dt">SKSpriteNode</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> <span class="va">smoothingFactor</span> <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">func</span> <span class="fu">update</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="va">gravity</span> <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        acceleration <span class="op">=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> gravity <span class="op">*</span> sin<span class="op">(</span>angle<span class="op">)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        velocity <span class="op">+=</span> acceleration</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        angle <span class="op">+=</span> velocity</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        angle <span class="op">*=</span> smoothingFactor  <span class="co">// Additional smoothing for chain effect</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        velocity <span class="op">*=</span> damping</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        zRotation <span class="op">=</span> angle</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        position <span class="op">=</span> CGPoint<span class="op">(</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            x<span class="op">:</span> radius <span class="op">*</span> sin<span class="op">(</span>angle<span class="op">),</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            y<span class="op">:</span> <span class="op">-</span>radius <span class="op">*</span> cos<span class="op">(</span>angle<span class="op">)</span> <span class="op">+</span> <span class="dv">120</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">)</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The mascot can be set swinging either by pressing the spacebar or
automatically via a timer:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Timer<span class="op">.</span>scheduledTimer<span class="op">(</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    withTimeInterval<span class="op">:</span> <span class="dv">600</span> <span class="op">*</span> Double<span class="op">.</span>random<span class="op">(</span><span class="cf">in</span><span class="op">:</span> <span class="fl">0.75</span><span class="op">..</span><span class="fl">.1.25</span><span class="op">),</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    repeats<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span> _ <span class="cf">in</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">self</span><span class="op">.</span>timerAction<span class="op">()</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">timerAction</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> Double<span class="op">.</span>random<span class="op">(</span><span class="cf">in</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">..</span><span class="fl">.1.0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.75</span> <span class="op">{</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        swingingSwitch <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        spinAll<span class="op">()</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">spinAll</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    mascot<span class="op">.</span>spin<span class="op">()</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> link <span class="cf">in</span> <span class="kw">self</span><span class="op">.</span>children <span class="op">{</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> link<span class="op">.</span>name <span class="op">==</span> <span class="st">&quot;single_chain_link&quot;</span> <span class="op">{</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> <span class="va">linkSprite</span> <span class="op">=</span> link <span class="kw">as</span><span class="op">!</span> SingleChainLink</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            linkSprite<span class="op">.</span>spin<span class="op">()</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The timer triggers roughly every
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math>
minutes (with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>±</mi><mn>25</mn></mrow><annotation encoding="application/x-tex">\pm 25</annotation></semantics></math>%
variation), and has a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>25</mn><annotation encoding="application/x-tex">25</annotation></semantics></math>%
chance of starting a swing. The <code>spin()</code> function gives the
mascot an initial velocity:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">spin</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    velocity <span class="op">=</span> <span class="fl">0.12</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This initial velocity
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.12</mn><annotation encoding="application/x-tex">0.12</annotation></semantics></math>
radians per frame at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>60</mn><annotation encoding="application/x-tex">60</annotation></semantics></math>
FPS, or approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7.2</mn><annotation encoding="application/x-tex">7.2</annotation></semantics></math>
radians per second) determines the amplitude of the swing. The update
loop runs at SpriteKit’s default
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>60</mn><annotation encoding="application/x-tex">60</annotation></semantics></math>
FPS, providing smooth physics simulation.</p>
<p>The simulation stops automatically when velocity drops below a
threshold:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">override</span> <span class="kw">func</span> <span class="fu">update</span><span class="op">(</span><span class="va">_</span> <span class="va">currentTime</span><span class="op">:</span> <span class="dt">TimeInterval</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> swingingSwitch <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        updateAll<span class="op">()</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> abs<span class="op">(</span>mascot<span class="op">.</span>velocity<span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.00001</span> <span class="op">{</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        swingingSwitch <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This conserves CPU cycles when the mascot is at rest, only running
physics calculations when actually swinging.</p>
<h1 id="sprite-animation-and-rendering">Sprite Animation and
Rendering</h1>
<p>Both applications use sprite-based rendering, but with different
approaches. xNeko uses SwiftUI’s <code>Image</code> view with
frame-by-frame animation controlled by a timer. The sprites are stored
in the asset catalog and loaded into arrays:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">createImageArray</span><span class="op">(</span><span class="va">imageNames</span><span class="op">:</span> <span class="dt">NSArray</span><span class="op">)</span> -&gt; <span class="fu">NSArray</span> <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="va">images</span> <span class="op">=</span> NSMutableArray<span class="op">()</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> imageName <span class="cf">in</span> imageNames <span class="op">{</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="va">image</span> <span class="op">=</span> NSImage<span class="op">(</span>named<span class="op">:</span> imageName <span class="kw">as</span><span class="op">!</span> NSImage<span class="op">.</span>Name<span class="op">)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        images<span class="op">.</span>add<span class="op">(</span>image <span class="kw">as</span> Any<span class="op">)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> images</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Each animation state maps to an array of frames. The current frame is
selected based on the tick count:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="va">imageArray</span> <span class="op">=</span> animations<span class="op">![</span>state<span class="op">]!</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> state <span class="op">!=</span> <span class="st">&quot;sleep&quot;</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    setImageTo<span class="op">(</span>imageObject<span class="op">:</span> imageArray<span class="op">.</span>object<span class="op">(</span>at<span class="op">:</span> tickCount <span class="op">%</span> imageArray<span class="op">.</span>count<span class="op">)</span> <span class="kw">as</span><span class="op">!</span> NSImage<span class="op">)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    setImageTo<span class="op">(</span>imageObject<span class="op">:</span> imageArray<span class="op">.</span>object<span class="op">(</span>at<span class="op">:</span> <span class="op">(</span>tickCount <span class="op">&gt;&gt;</span> <span class="dv">2</span><span class="op">)</span> <span class="op">%</span> imageArray<span class="op">.</span>count<span class="op">)</span> <span class="kw">as</span><span class="op">!</span> NSImage<span class="op">)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The sleep animation uses <code>(tickCount &gt;&gt; 2)</code>, which
divides by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>,
making it run at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mn>4</mn></mfrac><annotation encoding="application/x-tex">\frac{1}{4}</annotation></semantics></math>
speed for a slower breathing effect.</p>
<p>To maintain pixel-perfect rendering (preventing sprite blur), I use
nearest-neighbor interpolation:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Image<span class="op">(</span>nsImage<span class="op">:</span> image<span class="op">)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>interpolation<span class="op">(.</span>none<span class="op">)</span>  <span class="co">// Disable antialiasing</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>blendMode<span class="op">(.</span>sourceAtop<span class="op">)</span></span></code></pre></div>
<p>xMascot uses SpriteKit’s built-in sprite rendering, which handles
texture filtering automatically:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="va">texture</span> <span class="op">=</span> SKTexture<span class="op">(</span>imageNamed<span class="op">:</span> <span class="st">&quot;kuma&quot;</span><span class="op">)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>texture<span class="op">.</span>filteringMode <span class="op">=</span> <span class="op">.</span>nearest</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">super</span><span class="op">.</span><span class="kw">init</span><span class="op">(</span>texture<span class="op">:</span> texture<span class="op">,</span> color<span class="op">:</span> <span class="op">.</span>clear<span class="op">,</span> size<span class="op">:</span> texture<span class="op">.</span>size<span class="op">())</span></span></code></pre></div>
<p>Setting <code>filteringMode = .nearest</code> achieves the same
pixel-perfect rendering. SpriteKit’s rendering pipeline is more
efficient for multiple sprites (the chain links and mascot), while
SwiftUI is simpler for the single-sprite xNeko.</p>
<h1 id="vector-mathematics-for-animation">Vector Mathematics for
Animation</h1>
<p>xNeko extends <code>CGVector</code> with mathematical operations to
simplify displacement calculations:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extension</span> CGVector<span class="op">:</span> <span class="dt">AdditiveArithmetic</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> <span class="op">+</span> <span class="op">(</span>left<span class="op">:</span> CGVector<span class="op">,</span> right<span class="op">:</span> CGVector<span class="op">)</span> <span class="op">-&gt;</span> CGVector <span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> CGVector<span class="op">(</span>dx<span class="op">:</span> left<span class="op">.</span>dx <span class="op">+</span> right<span class="op">.</span>dx<span class="op">,</span> dy<span class="op">:</span> left<span class="op">.</span>dy <span class="op">+</span> right<span class="op">.</span>dy<span class="op">)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> - <span class="op">(</span><span class="va">left</span><span class="op">:</span> <span class="dt">CGVector</span><span class="op">,</span> <span class="va">right</span><span class="op">:</span> <span class="dt">CGVector</span><span class="op">)</span> -&gt; <span class="fu">CGVector</span> <span class="op">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> left <span class="op">+</span> <span class="op">(-</span>right<span class="op">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> <span class="op">+=</span> <span class="op">(</span>left<span class="op">:</span> <span class="cf">inout</span> CGVector<span class="op">,</span> right<span class="op">:</span> CGVector<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> left <span class="op">+</span> right</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> -<span class="op">=</span> <span class="op">(</span>left<span class="op">:</span> <span class="cf">inout</span> CGVector<span class="op">,</span> right<span class="op">:</span> CGVector<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> left <span class="op">-</span> right</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> prefix <span class="kw">func</span> - <span class="op">(</span><span class="va">vector</span><span class="op">:</span> <span class="dt">CGVector</span><span class="op">)</span> -&gt; <span class="fu">CGVector</span> <span class="op">{</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> CGVector<span class="op">(</span>dx<span class="op">:</span> <span class="op">-</span>vector<span class="op">.</span>dx<span class="op">,</span> dy<span class="op">:</span> <span class="op">-</span>vector<span class="op">.</span>dy<span class="op">)</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="kw">extension</span> CGVector <span class="op">{</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> <span class="op">*</span> <span class="op">(</span>left<span class="op">:</span> CGFloat<span class="op">,</span> right<span class="op">:</span> CGVector<span class="op">)</span> <span class="op">-&gt;</span> CGVector <span class="op">{</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> CGVector<span class="op">(</span>dx<span class="op">:</span> right<span class="op">.</span>dx <span class="op">*</span> left<span class="op">,</span> dy<span class="op">:</span> right<span class="op">.</span>dy <span class="op">*</span> left<span class="op">)</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">func</span> <span class="op">/</span> <span class="op">(</span>left<span class="op">:</span> CGVector<span class="op">,</span> right<span class="op">:</span> CGFloat<span class="op">)</span> <span class="op">-&gt;</span> CGVector <span class="op">{</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">guard</span> right <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">{</span> <span class="cf">fatalError</span><span class="op">(</span><span class="st">&quot;Division by zero&quot;</span><span class="op">)</span> <span class="op">}</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> CGVector<span class="op">(</span>dx<span class="op">:</span> left<span class="op">.</span>dx <span class="op">/</span> right<span class="op">,</span> dy<span class="op">:</span> left<span class="op">.</span>dy <span class="op">/</span> right<span class="op">)</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>These extensions enable natural vector arithmetic:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode swift"><code class="sourceCode swift"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>position <span class="op">+=</span> displacement  <span class="co">// Move window by displacement vector</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="va">normalized</span> <span class="op">=</span> displacement <span class="op">/</span> length  <span class="co">// Normalize to unit vector</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="va">scaled</span> <span class="op">=</span> <span class="fl">13.0</span> <span class="op">*</span> normalized  <span class="co">// Scale to maximum speed</span></span></code></pre></div>
<p>This makes the animation code more readable and less error-prone
compared to manually manipulating <code>dx</code> and <code>dy</code>
components.</p>
<h1 id="performance-and-resource-usage">Performance and Resource
Usage</h1>
<p>Desktop mascots run continuously in the background, so resource usage
is a concern. xNeko’s timer runs at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>6.67</mn><annotation encoding="application/x-tex">6.67</annotation></semantics></math>
FPS, which is very light on CPU. The main expense is the
<code>NSEvent.mouseLocation</code> call every frame and the window
position updates. On my MacBook Pro, xNeko uses less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>%
CPU when idle and around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math>-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>3</mn><annotation encoding="application/x-tex">3</annotation></semantics></math>%
when actively moving.</p>
<p>xMascot runs at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>60</mn><annotation encoding="application/x-tex">60</annotation></semantics></math>
FPS when swinging due to SpriteKit’s game loop, but only updates physics
when <code>swingingSwitch</code> is true. When at rest (most of the
time), it drops to minimal CPU usage. During active swinging, it uses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>5</mn><annotation encoding="application/x-tex">5</annotation></semantics></math>-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>8</mn><annotation encoding="application/x-tex">8</annotation></semantics></math>%
CPU, which is acceptable for a desktop toy.</p>
<p>Memory footprint is dominated by sprite textures. xNeko loads all
sprites for all characters upfront (around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>200</mn><annotation encoding="application/x-tex">200</annotation></semantics></math>
individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn><mo>×</mo><mn>32</mn></mrow><annotation encoding="application/x-tex">32 \times 32</annotation></semantics></math>
pixel images), consuming approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>15</mn><annotation encoding="application/x-tex">15</annotation></semantics></math>
MB. xMascot is lighter at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>3</mn><annotation encoding="application/x-tex">3</annotation></semantics></math>-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>
MB since it only has a few sprites and chain links.</p>
<p>Both applications use transparent overlays, which require compositor
resources but modern macOS handles this efficiently. Window transparency
is hardware-accelerated through Metal, so there’s no significant
performance penalty.</p>
<h1 id="lessons-learned">Lessons Learned</h1>
<p>Building these desktop mascots taught me several lessons about
animation and macOS development. First, state machines are powerful for
character animation. The xNeko behavior emerges from just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>18</mn><annotation encoding="application/x-tex">18</annotation></semantics></math>
states and simple transition rules, yet it feels alive and responsive.
Breaking animations into discrete states makes the code maintainable and
easy to extend with new behaviors.</p>
<p>Second, window management on macOS offers surprising flexibility. By
carefully configuring window properties, you can create overlays that
blend seamlessly with the desktop environment. The key is understanding
which properties to enable (floating level, transparency) and which to
disable (title bar, resizing, mouse interaction).</p>
<p>Third, physics simulation doesn’t require complex frameworks. The
pendulum motion in xMascot uses basic trigonometry and just a few lines
of code per frame, yet produces convincing swinging motion. The damping
factor is critical for making it feel realistic rather than perpetually
energetic.</p>
<p>Finally, sprite animation is about timing as much as artwork. The
sleep animation running at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mn>4</mn></mfrac><annotation encoding="application/x-tex">\frac{1}{4}</annotation></semantics></math>
speed conveys a completely different mood than the normal movement
states. Small details like this make characters feel more alive.</p>
<hr />
<p>Implementing desktop mascots demonstrates how simple animation
principles create engaging interactive experiences. The classic Neko
concept remains charming decades after its creation because it taps into
fundamental human tendency to anthropomorphize and interact with
animated characters. The physics-based pendulum mascot shows how
continuous simulation can complement discrete state machines for
different animation styles. Both projects served as explorations of
macOS windowing capabilities and Swift animation techniques, proving
that you don’t need complex game engines to create delightful desktop
companions. Understanding how each component works, from window
transparency to pendulum physics, provides appreciation for the
engineering behind seemingly simple animated characters that have
entertained computer users for over three decades.</p>
